{"ast":null,"code":"import { query as q } from 'faunadb';\nimport cookie from 'cookie';\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth';\nexport default async function logout(req, res) {\n  var _req$headers$cookie;\n\n  const cookies = cookie.parse((_req$headers$cookie = req.headers.cookie) !== null && _req$headers$cookie !== void 0 ? _req$headers$cookie : '');\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE];\n\n  if (!faunaSecret) {\n    // Already logged out.\n    return res.status(200).end();\n  } // Invalidate secret (ie. logout from Fauna).\n\n\n  await faunaClient(faunaSecret).query(q.Logout(false)); // Clear cookie.\n\n  const cookieSerialized = cookie.serialize(FAUNA_SECRET_COOKIE, '', {\n    sameSite: 'lax',\n    secure: false,\n    maxAge: -1,\n    httpOnly: true,\n    path: '/'\n  });\n  res.setHeader('Set-Cookie', cookieSerialized);\n  res.status(200).end();\n}","map":{"version":3,"sources":["C:/Users/marchi/projects/testyesty/pages/api/logout.js"],"names":["query","q","cookie","faunaClient","FAUNA_SECRET_COOKIE","logout","req","res","cookies","parse","headers","faunaSecret","status","end","Logout","cookieSerialized","serialize","sameSite","secure","maxAge","httpOnly","path","setHeader"],"mappings":"AAAA,SAASA,KAAK,IAAIC,CAAlB,QAA2B,SAA3B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,WAAT,EAAsBC,mBAAtB,QAAiD,wBAAjD;AAEA,eAAe,eAAeC,MAAf,CAAsBC,GAAtB,EAA2BC,GAA3B,EAAgC;AAAA;;AAC7C,QAAMC,OAAO,GAAGN,MAAM,CAACO,KAAP,wBAAaH,GAAG,CAACI,OAAJ,CAAYR,MAAzB,qEAAmC,EAAnC,CAAhB;AACA,QAAMS,WAAW,GAAGH,OAAO,CAACJ,mBAAD,CAA3B;;AACA,MAAI,CAACO,WAAL,EAAkB;AAChB;AACA,WAAOJ,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,GAAhB,EAAP;AACD,GAN4C,CAO7C;;;AACA,QAAMV,WAAW,CAACQ,WAAD,CAAX,CAAyBX,KAAzB,CAA+BC,CAAC,CAACa,MAAF,CAAS,KAAT,CAA/B,CAAN,CAR6C,CAS7C;;AACA,QAAMC,gBAAgB,GAAGb,MAAM,CAACc,SAAP,CAAiBZ,mBAAjB,EAAsC,EAAtC,EAA0C;AACjEa,IAAAA,QAAQ,EAAE,KADuD;AAEjEC,IAAAA,MAAM,OAF2D;AAGjEC,IAAAA,MAAM,EAAE,CAAC,CAHwD;AAIjEC,IAAAA,QAAQ,EAAE,IAJuD;AAKjEC,IAAAA,IAAI,EAAE;AAL2D,GAA1C,CAAzB;AAOAd,EAAAA,GAAG,CAACe,SAAJ,CAAc,YAAd,EAA4BP,gBAA5B;AACAR,EAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACD","sourcesContent":["import { query as q } from 'faunadb'\r\nimport cookie from 'cookie'\r\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth'\r\n\r\nexport default async function logout(req, res) {\r\n  const cookies = cookie.parse(req.headers.cookie ?? '')\r\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE]\r\n  if (!faunaSecret) {\r\n    // Already logged out.\r\n    return res.status(200).end()\r\n  }\r\n  // Invalidate secret (ie. logout from Fauna).\r\n  await faunaClient(faunaSecret).query(q.Logout(false))\r\n  // Clear cookie.\r\n  const cookieSerialized = cookie.serialize(FAUNA_SECRET_COOKIE, '', {\r\n    sameSite: 'lax',\r\n    secure: process.env.NODE_ENV === 'production',\r\n    maxAge: -1,\r\n    httpOnly: true,\r\n    path: '/',\r\n  })\r\n  res.setHeader('Set-Cookie', cookieSerialized)\r\n  res.status(200).end()\r\n}\r\n"]},"metadata":{},"sourceType":"module"}