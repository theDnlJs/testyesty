{"ast":null,"code":"import { query as q } from 'faunadb';\nimport cookie from 'cookie';\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth';\nexport const profileApi = async faunaSecret => {\n  const ref = await faunaClient(faunaSecret).query(q.Identity());\n  return ref.id;\n};\nexport default async function profile(req, res) {\n  var _req$headers$cookie;\n\n  const cookies = cookie.parse((_req$headers$cookie = req.headers.cookie) !== null && _req$headers$cookie !== void 0 ? _req$headers$cookie : '');\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE];\n\n  if (!faunaSecret) {\n    return res.status(401).send('Auth cookie missing.');\n  }\n\n  res.status(200).json({\n    userId: await profileApi(faunaSecret)\n  });\n}","map":{"version":3,"sources":["C:/Users/marchi/projects/testyesty/pages/api/profile.js"],"names":["query","q","cookie","faunaClient","FAUNA_SECRET_COOKIE","profileApi","faunaSecret","ref","Identity","id","profile","req","res","cookies","parse","headers","status","send","json","userId"],"mappings":"AAAA,SAASA,KAAK,IAAIC,CAAlB,QAA2B,SAA3B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,WAAT,EAAsBC,mBAAtB,QAAiD,wBAAjD;AAEA,OAAO,MAAMC,UAAU,GAAG,MAAOC,WAAP,IAAuB;AAC/C,QAAMC,GAAG,GAAG,MAAMJ,WAAW,CAACG,WAAD,CAAX,CAAyBN,KAAzB,CAA+BC,CAAC,CAACO,QAAF,EAA/B,CAAlB;AACA,SAAOD,GAAG,CAACE,EAAX;AACD,CAHM;AAKP,eAAe,eAAeC,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAAA;;AAC9C,QAAMC,OAAO,GAAGX,MAAM,CAACY,KAAP,wBAAaH,GAAG,CAACI,OAAJ,CAAYb,MAAzB,qEAAmC,EAAnC,CAAhB;AACA,QAAMI,WAAW,GAAGO,OAAO,CAACT,mBAAD,CAA3B;;AAEA,MAAI,CAACE,WAAL,EAAkB;AAChB,WAAOM,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,sBAArB,CAAP;AACD;;AAEDL,EAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBE,IAAhB,CAAqB;AAAEC,IAAAA,MAAM,EAAE,MAAMd,UAAU,CAACC,WAAD;AAA1B,GAArB;AACD","sourcesContent":["import { query as q } from 'faunadb'\r\nimport cookie from 'cookie'\r\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth'\r\n\r\nexport const profileApi = async (faunaSecret) => {\r\n  const ref = await faunaClient(faunaSecret).query(q.Identity())\r\n  return ref.id\r\n}\r\n\r\nexport default async function profile(req, res) {\r\n  const cookies = cookie.parse(req.headers.cookie ?? '')\r\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE]\r\n\r\n  if (!faunaSecret) {\r\n    return res.status(401).send('Auth cookie missing.')\r\n  }\r\n\r\n  res.status(200).json({ userId: await profileApi(faunaSecret) })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}